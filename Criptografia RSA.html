<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA</title>
</head>
<body>
    <script>
        /* * FUNÇÃO FORNECIDA - NÃO É NECESSÁRIO MODIFICAR. */
        function gerarChavesRSA_Didaticas(p, q) {
            if (p <= 1 || q <= 1) return null; 
            
            const N = p * q;
            const phi_N = (p - 1) * (q - 1);
            
            let E = 3;
            while (E < phi_N) {
                // Encontrar o primeiro E que é coprimo de phi_N
                if ((phi_N % E !== 0) && ((p - 1) % E !== 0) && ((q - 1) % E !== 0)) {
                    // Otimização: A verificação (p-1)%E e (q-1)%E não é rigorosamente a do RSA, 
                    // mas é didática e evita fatores óbvios para primos pequenos.
                    break;
                }
                E++;
            }

            let D = 1;
            while (D < phi_N) {
                // Encontrar D tal que (D * E) % phi_N === 1
                if ((D * E) % phi_N === 1) {
                    break;
                }
                D++;
            }
            
            return {
                publica: { E, N }, // Use E e N para CIFRAR
                privada: { D, N }  // Use D e N para DECIFRAR
            };
        }

        /**
         * Cifra a mensagem usando a chave pública (E, N).
         * @param {string} mensagem - O texto a ser cifrado.
         * @param {number} E - Expoente Público.
         * @param {number} N - Módulo.
         * @returns {number[]} Array de números (os códigos cifrados).
         */
        function cifrarRSA_Didatico(mensagem, E, N) {
            const mensagemCifrada = [];
            
            // Itera sobre cada caractere da mensagem
            for (let i = 0; i < mensagem.length; i++) {
                // Obtém o código ASCII/Unicode do caractere
                const x = mensagem.charCodeAt(i);
                
                // Aplica a fórmula: Cifrado = x^E mod N
                // Usando exponenciação modular para evitar números muito grandes
                const cifrado = exponenciacaoModular(x, E, N);
                
                mensagemCifrada.push(cifrado);
            }
            
            return mensagemCifrada;
        }

        /**
         * Decifra o array de números usando a chave privada (D, N).
         * @param {number[]} mensagemCifrada - Array de números cifrados.
         * @param {number} D - Expoente Privado.
         * @param {number} N - Módulo.
         * @returns {string} A string original.
         */
        function decifrarRSA_Didatico(mensagemCifrada, D, N) {
            let mensagemOriginal = '';
            
            // Itera sobre cada número cifrado
            for (let i = 0; i < mensagemCifrada.length; i++) {
                const C = mensagemCifrada[i];
                
                // Aplica a fórmula: Original = C^D mod N
                const original = exponenciacaoModular(C, D, N);
                
                // Converte o código de volta para caractere
                mensagemOriginal += String.fromCharCode(original);
            }
            
            return mensagemOriginal;
        }

        /**
         * Função auxiliar para calcular (base^expoente) mod modulo de forma eficiente.
         * Evita overflow com números grandes usando o método de exponenciação rápida.
         */
        function exponenciacaoModular(base, expoente, modulo) {
            let resultado = 1;
            base = base % modulo;
            
            while (expoente > 0) {
                // Se o expoente é ímpar, multiplica a base com o resultado
                if (expoente % 2 === 1) {
                    resultado = (resultado * base) % modulo;
                }
                
                // Agora o expoente deve ser par
                expoente = Math.floor(expoente / 2);
                base = (base * base) % modulo;
            }
            
            return resultado;
        }

        // ============ TESTES DE VALIDAÇÃO ============

        console.log("=== TESTES DE VALIDAÇÃO RSA ===\n");

        // Gerar chaves para os testes
        const p = 61;
        const q = 53;
        const CHAVES = gerarChavesRSA_Didaticas(p, q);

        console.log("Chaves Geradas:");
        console.log(`Chave Pública (E, N): (${CHAVES.publica.E}, ${CHAVES.publica.N})`);
        console.log(`Chave Privada (D, N): (${CHAVES.privada.D}, ${CHAVES.privada.N})`);
        console.log();

        // Texto para validação
        const textoOriginal = "OLA";
        console.log(`Texto Original: "${textoOriginal}"`);
        console.log();

        // 1. Cifrar com a Chave Pública
        const cifrado = cifrarRSA_Didatico(textoOriginal, CHAVES.publica.E, CHAVES.publica.N);
        console.log("RSA Cifrado:", cifrado); // Array de números

        // 2. Decifrar com a Chave Privada
        const decifrado = decifrarRSA_Didatico(cifrado, CHAVES.privada.D, CHAVES.privada.N);
        console.log("RSA Decifrado:", decifrado); // Esperado: "OLA"

        // // Verificação
        // console.log();
        // console.log("=== RESULTADO DA VALIDAÇÃO ===");
        // console.log(`Texto original: "${textoOriginal}"`);
        // console.log(`Texto decifrado: "${decifrado}"`);
        // console.log(`✓ Validação: ${textoOriginal === decifrado ? "SUCESSO" : "FALHA"}`);

        // // ============ TESTES ADICIONAIS ============
        // console.log("\n\n=== TESTES ADICIONAIS ===\n");

        // // Teste 1: Mensagem com espaços e números
        // console.log("Teste 1: Mensagem com espaços e números");
        // const msg1 = "RSA 2025";
        // const cif1 = cifrarRSA_Didatico(msg1, CHAVES.publica.E, CHAVES.publica.N);
        // const dec1 = decifrarRSA_Didatico(cif1, CHAVES.privada.D, CHAVES.privada.N);
        // console.log(`Original: "${msg1}" | Decifrado: "${dec1}" | ${msg1 === dec1 ? "✓" : "✗"}`);

        // // Teste 2: Mensagem com pontuação
        // console.log("\nTeste 2: Mensagem com pontuação");
        // const msg2 = "Ola, Mundo!";
        // const cif2 = cifrarRSA_Didatico(msg2, CHAVES.publica.E, CHAVES.publica.N);
        // const dec2 = decifrarRSA_Didatico(cif2, CHAVES.privada.D, CHAVES.privada.N);
        // console.log(`Original: "${msg2}" | Decifrado: "${dec2}" | ${msg2 === dec2 ? "✓" : "✗"}`);

        // // Teste 3: Caractere único
        // console.log("\nTeste 3: Caractere único");
        // const msg3 = "A";
        // const cif3 = cifrarRSA_Didatico(msg3, CHAVES.publica.E, CHAVES.publica.N);
        // const dec3 = decifrarRSA_Didatico(cif3, CHAVES.privada.D, CHAVES.privada.N);
        // console.log(`Original: "${msg3}" | Decifrado: "${dec3}" | ${msg3 === dec3 ? "✓" : "✗"}`);

    </script>
</body>
</html>